<!DOCTYPE html>
<html>
<head>
    <script src="three.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>    
</head>
<body>
    <script>
        var renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setSize(1000,1000);
        document.body.appendChild(renderer.domElement);
        renderer.clear();

        var scatterPlot = new THREE.Object3D();
        var mat = new THREE.PointsMaterial(
        {vertexColors: true, size: 1.5});
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(45, 1, 1, 10000);
        camera.position.z = 300;

        var renderer = new THREE.WebGLRenderer({antialias: true});
        var w = document.body.clientWidth;
        var h = document.body.clientHeight;
        renderer.setSize(w, h);
        document.body.appendChild(renderer.domElement);

        // background color
        renderer.setClearColor(new THREE.Color(0xEEEEEE));

        var camera = new THREE.PerspectiveCamera( 45, w/h, 1, 10000 );
        camera.position.z = 200;
        camera.position.x = 0;
        camera.position.y = 75;

        var scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2( 0xFFFFFF, 0.0035 );

        var scatterPlot = new THREE.Object3D();
        scene.add(scatterPlot);

        scatterPlot.rotation.y = 0.5;
        function v(x,y,z){ return new THREE.Vector3(x,y,z); }
        
        var lineGeo = new THREE.Geometry();
        lineGeo.vertices.push(

            v(-50, 50, -50), v(50, 50, -50),
            v(-50, -50, -50), v(50, -50, -50),
            v(-50, 50, 50), v(50, 50, 50),
            v(-50, -50, 50), v(50, -50, 50),

            v(50, -50, -50), v(50, 50, -50),
            v(-50, -50, -50), v(-50, 50, -50),
            v(50, -50, 50), v(50, 50, 50),
            v(-50, -50, 50), v(-50, 50, 50),

            v(50, 50, -50), v(50, 50, 50),
            v(50, -50, -50), v(50, -50, 50),
            v(-50, 50, -50), v(-50, 50, 50),
            v(-50, -50, -50), v(-50, -50, 50),

        );
            var lineMat = new THREE.LineBasicMaterial({color: 0x808080, linewidth: 1});
            var line = new THREE.Line(lineGeo, lineMat);
            line.type = THREE.Lines;
            scatterPlot.add(line);


        var pointCount = 10000;
        var pointGeo = new THREE.Geometry();
        for (var i=0; i<pointCount; i++) {
        var x = Math.random() * 100 - 50;
        var y = x*0.8+Math.random() * 20 - 10;
        var z = x*0.7+Math.random() * 30 - 15;
        pointGeo.vertices.push(new THREE.Vector3(x,y,z));
        pointGeo.colors.push(new THREE.Color().setColorName("Magenta");
        }
        var points = new THREE.ParticleSystem(pointGeo, mat);
        scatterPlot.add(points);
        scene.add(scatterPlot);

        scene.fog = new THREE.FogExp2(0xFFFFFF, 0.0035);
        renderer.render(scene, camera);
        var paused = false;
        var last = new Date().getTime();
        var down = false;
        var sx = 0, sy = 0;
        window.onmousedown = function (ev){
            down = true; sx = ev.clientX; sy = ev.clientY;
        };
        window.onmouseup = function(){ down = false; };
        window.onmousemove = function(ev) {
            if (down) {
            var dx = ev.clientX - sx;
            var dy = ev.clientY - sy;
            scatterPlot.rotation.y += dx*0.01;
            camera.position.y += dy;
            sx += dx;
            sy += dy;
            }
        }
        var animating = false;
        window.ondblclick = function() { animating = !animating; };
        function animate(t) {
            if (!paused) {
            last = t;
            if (animating) {
                var v = pointGeo.vertices;
                for (var i=0; i<v.length; i++) {
                var u = v[i];
                u.angle += u.speed * 0.01;
                u.position.x = Math.cos(u.angle)*u.radius;
                u.position.z = Math.sin(u.angle)*u.radius;
                }
                pointGeo.__dirtyVertices = true;
            }
            renderer.clear();
            camera.lookAt(scene.position);
            renderer.render(scene, camera);
            }
            window.requestAnimationFrame(animate, renderer.domElement);
        }
        animate(new Date().getTime());
        onmessage = function(ev) {
            paused = (ev.data == 'pause');
        };
    </script>
</body>    
</html>